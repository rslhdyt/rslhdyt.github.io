<!DOCTYPE html> <html lang="en" class="h-full"> <head> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LTH48DE8D"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-2LTH48DE8D'); </script> <meta charset="utf-8"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta name=author content="Risal Hidayat"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Rails Disable Route Format | Risal Hidayat</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Rails Disable Route Format" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Learn how to disable Rails route formats (.xml, .json) to prevent unwanted format requests and clean up your error logs. Simple solutions to improve your Rails app’s security and monitoring." /> <meta property="og:description" content="Learn how to disable Rails route formats (.xml, .json) to prevent unwanted format requests and clean up your error logs. Simple solutions to improve your Rails app’s security and monitoring." /> <link rel="canonical" href="https://rslhdyt.dev/rails-disable-route-format/" /> <meta property="og:url" content="https://rslhdyt.dev/rails-disable-route-format/" /> <meta property="og:site_name" content="Risal Hidayat" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-03-11T17:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Rails Disable Route Format" /> <meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-03-11T17:00:00+00:00","datePublished":"2024-03-11T17:00:00+00:00","description":"Learn how to disable Rails route formats (.xml, .json) to prevent unwanted format requests and clean up your error logs. Simple solutions to improve your Rails app’s security and monitoring.","headline":"Rails Disable Route Format","mainEntityOfPage":{"@type":"WebPage","@id":"https://rslhdyt.dev/rails-disable-route-format/"},"url":"https://rslhdyt.dev/rails-disable-route-format/"}</script> <!-- End Jekyll SEO tag --> <link rel="apple-touch-icon" sizes="180x180" href="https://rslhdyt.dev/assets/images/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="https://rslhdyt.dev/assets/images/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="https://rslhdyt.dev/assets/images/favicon/favicon-16x16.png"> <link rel="manifest" href="https://rslhdyt.dev/site.webmanifest"> <link rel="alternate" type="application/rss+xml" title="Risal Hidayat" href="https://rslhdyt.dev/feed.xml" /> <script src="https://kit.fontawesome.com/d9b09040a7.js" crossorigin="anonymous"></script> <!-- highlight.js --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css" integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg==" crossorigin="anonymous" referrerpolicy="no-referrer" /> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script> <script>hljs.highlightAll();</script> <link rel="stylesheet" href="/assets/css/main.css"> </head> <body class="bg-zinc-50 flex h-full"> <div class="max-w-[600px] flex flex-col mx-auto w-11/12"> <nav class=" mt-7 md:mt-10 mb-10"> <ul class="flex flex-row justify-center space-x-6 text-l text-gray-500"> <li> <a href="https://rslhdyt.dev/">Home</a> </li> <li> <a href="https://rslhdyt.dev/blog">Blog</a> </li> <li class="item hidden sm:block"> <a href="https://rslhdyt.dev/code_snippet">Code Snippet</a> </li> <li> <a href="https://rslhdyt.dev/projects">Projects</a> </li> <li> <a href="https://rslhdyt.dev/about">About</a> </li> </ul> </nav> <h1 class="text-3xl text-center tracking-tight font-bold mb-5">Rails Disable Route Format</h1> <span class="block text-center mb-5"> <time datetime="11-03-2024">Monday. March 11, 2024</time> - <span class="reading-time" title="Estimated read time"> 2 mins read </span> </span> <div class="flex flex-row space-x-1.5 justify-center mb-10"> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/rails">rails</a> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/webhookdump">webhookdump</a> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/security">security</a> </div> <div class="posts"> <p>Today, while checking my APM (Application Performance Monitoring) tools, I found some strange errors in the reports. After looking closer, I realized these errors were coming from people trying to access my webhook URLs by adding format extensions like <code class="language-plaintext highlighter-rouge">/blog.xml</code> or <code class="language-plaintext highlighter-rouge">/blog.json</code>. Even though these endpoints don’t exist in my app, these requests were creating unnecessary error alerts.</p> <p>In this post, I’ll show you how to disable these format extensions in Rails to avoid similar issues.</p> <h2 id="whats-happening">What’s Happening?</h2> <p>By default, Rails allows URLs to end with format extensions (like .xml, .json, .csv). This means when someone tries to access:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /webhooks.xml
GET /webhooks.json
</code></pre></div></div> <p>Rails will try to respond to these requests. If you haven’t set up your app to handle these formats, it returns a 404 error, which then shows up in your error monitoring tools.</p> <h2 id="how-to-fix-this">How to Fix This</h2> <p>There are three ways to solve this problem. Choose the one that fits your needs best:</p> <h3 id="option-1-turn-off-formats-for-all-routes">Option 1: Turn Off Formats for All Routes</h3> <p>This is the simplest solution. In your <code class="language-plaintext highlighter-rouge">config/routes.rb</code> file, add:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">default_format</span> <span class="ss">:html</span>

  <span class="c1"># Your routes here</span>
  <span class="n">resources</span> <span class="ss">:webhooks</span><span class="p">,</span> <span class="ss">format: </span><span class="kp">false</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="option-2-turn-off-formats-for-specific-routes-only">Option 2: Turn Off Formats for Specific Routes Only</h3> <p>If you want to keep formats for some routes (like an API) but disable them for others:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="c1"># API routes that can still use formats</span>
  <span class="n">namespace</span> <span class="ss">:api</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:webhooks</span>
  <span class="k">end</span>

  <span class="c1"># Regular routes without formats</span>
  <span class="n">scope</span> <span class="ss">format: </span><span class="kp">false</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:webhooks</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="option-3-use-format-constraints">Option 3: Use Format Constraints</h3> <p>For more control over which routes accept formats:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">constraints</span> <span class="ss">format: </span><span class="kp">false</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'/blog'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'blog#index'</span>
    <span class="n">resources</span> <span class="ss">:posts</span>
  <span class="k">end</span>

  <span class="c1"># Routes outside this block can still use formats</span>
<span class="k">end</span>
</code></pre></div></div> <p>source constraint: <a href="https://guides.rubyonrails.org/routing.html#specifying-constraints">https://guides.rubyonrails.org/routing.html#specifying-constraints</a></p> <h2 id="what-to-check-after-making-changes">What to Check After Making Changes</h2> <ol> <li>Run <code class="language-plaintext highlighter-rouge">rails routes</code> to see how your changes affected your routes</li> <li>Watch your logs to make sure real requests aren’t being blocked</li> <li>Test your changes in development before pushing to production</li> </ol> <h2 id="results-from-my-experience">Results From My Experience</h2> <p>After I made these changes:</p> <ul> <li>My APM stopped showing errors from these format requests</li> <li>My error logs became cleaner and easier to read</li> <li>It became easier to spot real issues in the logs</li> </ul> </div> <div class="grid grid-cols-2 text-sm"> <a class="prev" href="https://rslhdyt.dev/webhookdump-database-design/">&laquo; WebhookDump: Database Design</a> <a class="next" href="https://rslhdyt.dev/navigating-docker-debugging-challenges-overriding-entrypoint/">Navigating Docker Debugging Challenges: Overriding ENTRYPOINT &raquo;</a> </div> <div class="related"> <h4 class="text-xl my-5">Related Posts</h4> <ul class="list-disc list-inside"> <li class="pl-8"> <a href="https://rslhdyt.dev/creating-custom-ufw-application-profiles/">Creating Custom UFW Application Profiles </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/til-handling-changes-to-sidekiq-worker-class/">TIL: Handling Changes to Sidekiq Worker Class </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/fix-dotenv-not-properly-setup-in-foreman/">Fix dotenv not properly setup in Foreman </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/webhookdump-database-design/">WebhookDump: Database Design </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/">Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation </a> </li> </ul> </div> <footer class="flex justify-center items-center border-solid border-0 border-t border-gray-200 p-10 mt-10"> Risal Hidayat © 2024 </footer> </div> </body> </html>
