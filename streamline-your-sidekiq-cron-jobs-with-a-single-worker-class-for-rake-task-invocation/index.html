<!DOCTYPE html> <html lang="en" class="h-full"> <head> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LTH48DE8D"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-2LTH48DE8D'); </script> <meta charset="utf-8"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta name=author content="Risal Hidayat"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation | Risal Hidayat</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Optimize Sidekiq Cron with a Single Worker Class for Rake Tasks. Simplify configuration, improve maintenance, and enhance testing capabilities. Streamline your Rails app’s background job scheduling today!" /> <meta property="og:description" content="Optimize Sidekiq Cron with a Single Worker Class for Rake Tasks. Simplify configuration, improve maintenance, and enhance testing capabilities. Streamline your Rails app’s background job scheduling today!" /> <link rel="canonical" href="https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/" /> <meta property="og:url" content="https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/" /> <meta property="og:site_name" content="Risal Hidayat" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-02-29T17:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation" /> <meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-02-29T17:00:00+00:00","datePublished":"2024-02-29T17:00:00+00:00","description":"Optimize Sidekiq Cron with a Single Worker Class for Rake Tasks. Simplify configuration, improve maintenance, and enhance testing capabilities. Streamline your Rails app’s background job scheduling today!","headline":"Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation","mainEntityOfPage":{"@type":"WebPage","@id":"https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/"},"url":"https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/"}</script> <!-- End Jekyll SEO tag --> <link rel="apple-touch-icon" sizes="180x180" href="https://rslhdyt.dev/assets/images/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="https://rslhdyt.dev/assets/images/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="https://rslhdyt.dev/assets/images/favicon/favicon-16x16.png"> <link rel="manifest" href="https://rslhdyt.dev/site.webmanifest"> <link rel="canonical" href="https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/"> <link rel="alternate" type="application/rss+xml" title="Risal Hidayat" href="https://rslhdyt.dev/feed.xml" /> <script src="https://kit.fontawesome.com/d9b09040a7.js" crossorigin="anonymous"></script> <!-- highlight.js --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css" integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg==" crossorigin="anonymous" referrerpolicy="no-referrer" /> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script> <script>hljs.highlightAll();</script> <link rel="stylesheet" href="/assets/css/main.css"> </head> <body class="bg-zinc-50 flex h-full"> <div class="max-w-[600px] flex flex-col mx-auto w-11/12"> <nav class=" mt-7 md:mt-10 mb-10"> <ul class="flex flex-row justify-center space-x-6 text-l text-gray-500"> <li> <a href="https://rslhdyt.dev/">Home</a> </li> <li> <a href="https://rslhdyt.dev/blog">Blog</a> </li> <li class="item hidden sm:block"> <a href="https://rslhdyt.dev/code_snippet">Code Snippet</a> </li> <li> <a href="https://rslhdyt.dev/projects">Projects</a> </li> <li> <a href="https://rslhdyt.dev/about">About</a> </li> </ul> </nav> <h1 class="text-3xl text-center tracking-tight font-bold mb-5">Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation</h1> <span class="block text-center mb-5"> <time datetime="29-02-2024">Thursday. February 29, 2024</time> - <span class="reading-time" title="Estimated read time"> 2 mins read </span> </span> <div class="flex flex-row space-x-1.5 justify-center mb-10"> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/rails">rails</a> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/sidekiq">sidekiq</a> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/sidekiq-cron">sidekiq-cron</a> </div> <div class="posts"> <p><img src="https://media3.giphy.com/media/rytLWOErAX1F6/giphy.gif?cid=7941fdc631ow1c0odtfzkiifp1koqyox9jvx7qe7zat8fxhr&amp;ep=v1_gifs_search&amp;rid=giphy.gif&amp;ct=g" alt="" /></p> <p><em></em></p> <p>Running scheduled processes using Sidekiq Cron was a breeze. The setup process involves adding the Sidekiq Cron gem to the Gemfile and configuring the schedule.yml file to define cron schedule definitions. Additionally, the Sidekiq dashboard provides a convenient page to view the registered cron jobs.</p> <p>Typically, when running a scheduled process, separate Sidekiq worker classes are created for each cron job, and within these workers, another service or rake task is invoked.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">daily_backup_worker</span><span class="pi">:</span>
  <span class="na">cron</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*"</span>
  <span class="na">class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">DailyBackupWorker"</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Run</span><span class="nv"> </span><span class="s">daily</span><span class="nv"> </span><span class="s">backup</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">midnight"</span>
<span class="na">weekly_backup_worker</span><span class="pi">:</span>
  <span class="na">cron</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0"</span>
  <span class="na">class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">WeeklyBackupWorker"</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Run</span><span class="nv"> </span><span class="s">weekly</span><span class="nv"> </span><span class="s">backup</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Sunday</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">midnight"</span>
</code></pre></div></div> <p>For example, in the <code class="language-plaintext highlighter-rouge">DailyBackupWorker</code> class, the existing rake task command <code class="language-plaintext highlighter-rouge">db:backup</code> is called to trigger the database backup:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'rake'</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">load_tasks</span>

<span class="k">class</span> <span class="nc">DailyBackupWorker</span>
  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">perform</span>
    <span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="p">[</span><span class="s1">'db:backup'</span><span class="p">].</span><span class="nf">execute</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Similarly, the <code class="language-plaintext highlighter-rouge">WeeklyBackupWorker</code> class would have similar code. However, it is possible to streamline the process by using a single class to handle rake task invocation within the Sidekiq cron worker.</p> <p>Introducing the <code class="language-plaintext highlighter-rouge">InvokeRakeTaskWorker</code> class:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'rake'</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">load_tasks</span>

<span class="k">class</span> <span class="nc">InvokeRakeTaskWorker</span>
  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="p">[</span><span class="n">command</span><span class="p">[</span><span class="s1">'task'</span><span class="p">]].</span><span class="nf">execute</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="s1">'args'</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>And you can change your schedule.yml into like this.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">daily_backup_worker</span><span class="pi">:</span>
  <span class="na">cron</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*"</span>
  <span class="na">class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">InvokeRakeTaskWorker"</span>
  <span class="na">args</span><span class="pi">:</span>
    <span class="na">task</span><span class="pi">:</span> <span class="s2">"</span><span class="s">db:backup"</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Run</span><span class="nv"> </span><span class="s">daily</span><span class="nv"> </span><span class="s">backup</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">midnight"</span>
<span class="na">weekly_backup_worker</span><span class="pi">:</span>
  <span class="na">cron</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0"</span>
  <span class="na">class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">InvokeRakeTaskWorker"</span>
  <span class="na">args</span><span class="pi">:</span>
    <span class="na">task</span><span class="pi">:</span> <span class="s2">"</span><span class="s">db:backup"</span>
    <span class="na">args</span><span class="pi">:</span> <span class="s2">"</span><span class="s">--weekly"</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Run</span><span class="nv"> </span><span class="s">weekly</span><span class="nv"> </span><span class="s">backup</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Sunday</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">midnight"</span>
</code></pre></div></div> <h3 id="conclusion">Conclusion</h3> <p>That it’s, now you can use single class to invoke rake command inside sidekiq cron schedule.</p> <p>using a single class to handle rake task invocation within the Sidekiq cron worker brings benefits such as code reusability, simplified configuration, flexibility, easier maintenance, and improved testing capabilities. Carefully evaluate the trade-offs and consider the specific requirements of your application before deciding on the approach to use.</p> </div> <div class="grid grid-cols-2 text-sm"> <a class="prev" href="https://rslhdyt.dev/setting-up-a-rails-project-for-webhookdump/">&laquo; Setting Up a Rails Project for Webhookdump</a> <a class="next" href="https://rslhdyt.dev/webhookdump-database-design/">WebhookDump: Database Design &raquo;</a> </div> <div class="related"> <h4 class="text-xl my-5">Related Posts</h4> <ul class="list-disc list-inside"> <li class="pl-8"> <a href="https://rslhdyt.dev/webhookdump-database-design/">WebhookDump: Database Design </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/setting-up-a-rails-project-for-webhookdump/">Setting Up a Rails Project for Webhookdump </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/how-to-create-a-copy-to-clipboard-action-in-stimulus/">How to Create a Copy-to-Clipboard Action in Stimulus </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/rails-authentication-setup-omniauth-using-devise/">Rails Authentication: Setup Omniauth using Devise </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/rails-authentication-login-with-magic-link/">Rails Authentication Login with magic link </a> </li> </ul> </div> <footer class="flex justify-center items-center border-solid border-0 border-t border-gray-200 p-10 mt-10"> Risal Hidayat © 2024 </footer> </div> </body> </html>
