<!DOCTYPE html> <html lang="en" class="h-full"> <head> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LTH48DE8D"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-2LTH48DE8D'); </script> <meta charset="utf-8"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta name=author content="Risal Hidayat"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Rails Authentication: Setup Omniauth using Devise | Risal Hidayat</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Rails Authentication: Setup Omniauth using Devise" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A blog about technology and stuff related" /> <meta property="og:description" content="A blog about technology and stuff related" /> <link rel="canonical" href="https://rslhdyt.dev/rails-authentication-setup-omniauth-using-devise/" /> <meta property="og:url" content="https://rslhdyt.dev/rails-authentication-setup-omniauth-using-devise/" /> <meta property="og:site_name" content="Risal Hidayat" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2023-11-23T17:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Rails Authentication: Setup Omniauth using Devise" /> <meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-23T17:00:00+00:00","datePublished":"2023-11-23T17:00:00+00:00","description":"A blog about technology and stuff related","headline":"Rails Authentication: Setup Omniauth using Devise","mainEntityOfPage":{"@type":"WebPage","@id":"https://rslhdyt.dev/rails-authentication-setup-omniauth-using-devise/"},"url":"https://rslhdyt.dev/rails-authentication-setup-omniauth-using-devise/"}</script> <!-- End Jekyll SEO tag --> <link rel="apple-touch-icon" sizes="180x180" href="https://rslhdyt.dev/assets/images/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="https://rslhdyt.dev/assets/images/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="https://rslhdyt.dev/assets/images/favicon/favicon-16x16.png"> <link rel="manifest" href="https://rslhdyt.dev/site.webmanifest"> <link rel="canonical" href="https://rslhdyt.dev/rails-authentication-setup-omniauth-using-devise/"> <link rel="alternate" type="application/rss+xml" title="Risal Hidayat" href="https://rslhdyt.dev/feed.xml" /> <script src="https://kit.fontawesome.com/d9b09040a7.js" crossorigin="anonymous"></script> <!-- highlight.js --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css" integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg==" crossorigin="anonymous" referrerpolicy="no-referrer" /> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script> <script>hljs.highlightAll();</script> <link rel="stylesheet" href="/assets/css/main.css"> </head> <body class="bg-zinc-50 flex h-full"> <div class="max-w-[600px] flex flex-col mx-auto w-11/12"> <nav class=" mt-7 md:mt-10 mb-10"> <ul class="flex flex-row justify-center space-x-6 text-l text-gray-500"> <li> <a href="https://rslhdyt.dev/">Home</a> </li> <li> <a href="https://rslhdyt.dev/blog">Blog</a> </li> <li class="item hidden sm:block"> <a href="https://rslhdyt.dev/code_snippet">Code Snippet</a> </li> <li> <a href="https://rslhdyt.dev/projects">Projects</a> </li> <li> <a href="https://rslhdyt.dev/about">About</a> </li> </ul> </nav> <h1 class="text-3xl text-center tracking-tight font-bold mb-5">Rails Authentication: Setup Omniauth using Devise</h1> <span class="block text-center mb-5"> <time datetime="23-11-2023">Thursday. November 23, 2023</time> - <span class="reading-time" title="Estimated read time"> 2 mins read </span> </span> <div class="flex flex-row space-x-1.5 justify-center mb-10"> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/rails">rails</a> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/tutorial">tutorial</a> </div> <div class="posts"> <p><img src="https://images.unsplash.com/flagged/photo-1561023367-50a6e054d890?ixlib=rb-4.0.3&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb" alt="" /></p> <p><em></em></p> <p>Introduction</p> <p>Social login or omniauth is one of must have authentication in web application. It helps our to onboard the users who is reluctant to fill the registration form and register or login by using the account from another services like google or github.</p> <p>What is omniauth</p> <p>Omniauth is one of authentication method that allowed a user logged in or register to our application with the credentials or user information from another service. Omniauth use Oauth protocol to process the authentication and get user information.</p> <p>Implementing Omniauth in rails application using devise</p> <p>Devise has by default has a setting to enable or disable the omniauth authentication. However, we need to install separated oauth providers that we want to use. In this tutorial, I will use google as the oauth provider.</p> <p>Obtaining google credentials for omniauth</p> <p>I assumed you have google cloud platform account and project. those information required to create the oauth credentials.</p> <p>Go to google console and go to APIs &amp; Service menu and select submenu Credentials</p> <p><img src="/assets/images/posts/4667ee20-697a-4111-8e32-dc2aba35ed99-Untitled.png" alt="" /></p> <p><em></em></p> <p>On the credentials page, click the Create Credentials button and choose the Oauth Client ID dropdown option</p> <p><img src="/assets/images/posts/871ea8c2-828c-46a4-90aa-6a2fff175a3a-Untitled.png" alt="" /></p> <p><em></em></p> <p>Select <code class="language-plaintext highlighter-rouge">Web applications</code> and provide a name. Under the <code class="language-plaintext highlighter-rouge">Authorized redirect URIs</code> add the path to callback endpoint. I put <code class="language-plaintext highlighter-rouge">http://localhost:3000/auth/google_oauth2/callback</code>.</p> <p><img src="/assets/images/posts/1b58e32c-53c4-4b61-aafa-8e78d7a64532-Untitled.png" alt="" /></p> <p><em></em></p> <p>After the form submited, the modal will be shown, copy Client ID and Client Secret and put it in environment config file like this.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">GOOGLE_CLIENT_ID</span><span class="o">=</span><span class="no">YOUR_CLIENT_ID</span>
<span class="no">GOOGLE_CLIENT_SECRET</span><span class="o">=</span><span class="no">YOUR_CLIENT_SECRET</span>
</code></pre></div></div> <p><img src="/assets/images/posts/0168a681-8603-402f-838a-11156a4f8926-Untitled.png" alt="" /></p> <p><em></em></p> <p>Installing google provider gem</p> <p>To enable the login using google we need to install additional gem, add this gem to your Gemfile</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'omniauth-google-oauth2'</span>
</code></pre></div></div> <p>Don’t forget to run bundle install after adding new gem in Gemfile.</p> <p>Update devise config</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Devise</span><span class="p">.</span><span class="nf">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="o">...</span>

  <span class="c1"># uncomment this line below</span>
  <span class="c1"># config.omniauth :google_oauth2, CLIENT_ID, CLIENT_SECRET, {}</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">omniauth</span> <span class="ss">:google_oauth2</span><span class="p">,</span> <span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s1">'GOOGLE_CLIENT_ID'</span><span class="p">,</span> <span class="kp">nil</span><span class="p">),</span> <span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s1">'GOOGLE_CLIENT_SECRET'</span><span class="p">,</span> <span class="kp">nil</span><span class="p">),</span> <span class="p">{}</span>

  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div> </div> <div class="grid grid-cols-2 text-sm"> <a class="prev" href="https://rslhdyt.dev/flipper-retrieve-a-list-of-features-for-an-actor/">&laquo; Flipper: Retrieve a List of Features for an Actor</a> <a class="next" href="https://rslhdyt.dev/how-to-create-a-copy-to-clipboard-action-in-stimulus/">How to Create a Copy-to-Clipboard Action in Stimulus &raquo;</a> </div> <div class="related"> <h4 class="text-xl my-5">Related Posts</h4> <ul class="list-disc list-inside"> <li class="pl-8"> <a href="https://rslhdyt.dev/fix-dotenv-not-properly-setup-in-foreman/">Fix dotenv not properly setup in Foreman </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/webhookdump-database-design/">WebhookDump: Database Design </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/">Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/setting-up-a-rails-project-for-webhookdump/">Setting Up a Rails Project for Webhookdump </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/how-to-create-a-copy-to-clipboard-action-in-stimulus/">How to Create a Copy-to-Clipboard Action in Stimulus </a> </li> </ul> </div> <footer class="flex justify-center items-center border-solid border-0 border-t border-gray-200 p-10 mt-10"> Risal Hidayat © 2024 </footer> </div> </body> </html>
