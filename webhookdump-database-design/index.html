<!DOCTYPE html> <html lang="en" class="h-full"> <head> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LTH48DE8D"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-2LTH48DE8D'); </script> <meta charset="utf-8"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta name=author content="Risal Hidayat"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>WebhookDump: Database Design | Risal Hidayat</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="WebhookDump: Database Design" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="In this chapter of my journey, I began adding features to the Webhookdump application. The first step? Database design." /> <meta property="og:description" content="In this chapter of my journey, I began adding features to the Webhookdump application. The first step? Database design." /> <link rel="canonical" href="https://rslhdyt.dev/webhookdump-database-design/" /> <meta property="og:url" content="https://rslhdyt.dev/webhookdump-database-design/" /> <meta property="og:site_name" content="Risal Hidayat" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-03-06T17:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="WebhookDump: Database Design" /> <meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-03-06T17:00:00+00:00","datePublished":"2024-03-06T17:00:00+00:00","description":"In this chapter of my journey, I began adding features to the Webhookdump application. The first step? Database design.","headline":"WebhookDump: Database Design","mainEntityOfPage":{"@type":"WebPage","@id":"https://rslhdyt.dev/webhookdump-database-design/"},"url":"https://rslhdyt.dev/webhookdump-database-design/"}</script> <!-- End Jekyll SEO tag --> <link rel="apple-touch-icon" sizes="180x180" href="https://rslhdyt.dev/assets/images/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="https://rslhdyt.dev/assets/images/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="https://rslhdyt.dev/assets/images/favicon/favicon-16x16.png"> <link rel="manifest" href="https://rslhdyt.dev/site.webmanifest"> <link rel="alternate" type="application/rss+xml" title="Risal Hidayat" href="https://rslhdyt.dev/feed.xml" /> <script src="https://kit.fontawesome.com/d9b09040a7.js" crossorigin="anonymous"></script> <!-- highlight.js --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/a11y-dark.min.css" integrity="sha512-Vj6gPCk8EZlqnoveEyuGyYaWZ1+jyjMPg8g4shwyyNlRQl6d3L9At02ZHQr5K6s5duZl/+YKMnM3/8pDhoUphg==" crossorigin="anonymous" referrerpolicy="no-referrer" /> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script> <script>hljs.highlightAll();</script> <link rel="stylesheet" href="/assets/css/main.css"> </head> <body class="bg-zinc-50 flex h-full"> <div class="max-w-[600px] flex flex-col mx-auto w-11/12"> <nav class=" mt-7 md:mt-10 mb-10"> <ul class="flex flex-row justify-center space-x-6 text-l text-gray-500"> <li> <a href="https://rslhdyt.dev/">Home</a> </li> <li> <a href="https://rslhdyt.dev/blog">Blog</a> </li> <li class="item hidden sm:block"> <a href="https://rslhdyt.dev/code_snippet">Code Snippet</a> </li> <li> <a href="https://rslhdyt.dev/projects">Projects</a> </li> <li> <a href="https://rslhdyt.dev/about">About</a> </li> </ul> </nav> <h1 class="text-3xl text-center tracking-tight font-bold mb-5">WebhookDump: Database Design</h1> <span class="block text-center mb-5"> <time datetime="06-03-2024">Wednesday. March 06, 2024</time> - <span class="reading-time" title="Estimated read time"> 3 mins read </span> </span> <div class="flex flex-row space-x-1.5 justify-center mb-10"> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/webhookdump">webhookdump</a> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/rails">rails</a> <a class="bg-gray-200 px-2 rounded-sm font-thin" href="https://rslhdyt.dev/tags/database-migration">database-migration</a> </div> <div class="posts"> <blockquote> <p>ðŸ’¡ <em>See the code for this post on theÂ ðŸ”—Â <strong><a href="https://github.com/rslhdyt/webhookdump/tree/setup-models">setup-models</a></strong>Â branch.</em></p> </blockquote> <p>In this chapter of my journey, I began adding features to the Webhookdump application. The first step? Database design.</p> <p>The design of the Webhookdump application is simple, requiring only two tables to store incoming HTTP request details.</p> <p><img src="/assets/images/posts/e8bcb268-1665-4750-85d4-4f04e18de497-webhookdump-erb.png" alt="" /></p> <p>Here are the definitions for each table, including the fields:</p> <p>TheÂ <code class="language-plaintext highlighter-rouge">webhooks</code>Â table stores information about the webhook URL. It contains two main attributes:Â <code class="language-plaintext highlighter-rouge">slug</code>Â andÂ <code class="language-plaintext highlighter-rouge">expired_at</code>.</p> <ul> <li><code class="language-plaintext highlighter-rouge">slug</code>: This string field uniquely identifies the webhook URL. For now, users receive an UUID as a slug. However, I plan to make the slug editable by the user in the future, so users can have readable URLs likeÂ <code class="language-plaintext highlighter-rouge">webhookdump.com/this-is-my-unique-slug</code>.</li> <li><code class="language-plaintext highlighter-rouge">expired_at</code> This attribute stores the expiration date of the webhook link. Once the webhook link expires, it can no longer be used.</li> </ul> <p>The second table,Â <code class="language-plaintext highlighter-rouge">webhook_requests</code>, stores incoming HTTP requests from the client, including information like the requester IP, URL, host, HTTP method, query params, headers, and the request body or payload. This table performs heavy write operations compared to the parent table.</p> <h3 id="setup-and-models-and-database-migration">Setup and models and database migration</h3> <p>Rails has an excellent code generator calledÂ <code class="language-plaintext highlighter-rouge">rails scaffold</code>. When you create a model using the scaffold script, it also generates the database migration.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails generate model webhook slug:string expired_at:date
      invoke  active_record
      create    db/migrate/20240324005540_create_webhooks.rb
      create    app/models/webhook.rb
      invoke    test_unit
      create      <span class="nb">test</span>/models/webhook_test.rb
      create      <span class="nb">test</span>/fixtures/webhooks.yml
</code></pre></div></div> <p>Hereâ€™s the migration file for theÂ <code class="language-plaintext highlighter-rouge">webhooks</code>Â table:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateWebhooks</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">7.1</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:webhooks</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:slug</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">date</span> <span class="ss">:expired_at</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Next, I created the second model and migration.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rails</span> <span class="n">generate</span> <span class="n">model</span> <span class="n">webhook_request</span> <span class="n">webhook</span><span class="ss">:references</span> <span class="n">ip</span><span class="ss">:string</span> <span class="n">url</span><span class="ss">:string</span> <span class="n">host</span><span class="ss">:string</span> <span class="nb">method</span><span class="ss">:string</span> <span class="n">query_params</span><span class="ss">:text</span> <span class="n">headers</span><span class="ss">:text</span> <span class="n">payload</span><span class="ss">:text</span>
      <span class="n">invoke</span>  <span class="n">active_record</span>
      <span class="n">create</span>    <span class="n">db</span><span class="o">/</span><span class="n">migrate</span><span class="o">/</span><span class="mi">20240324010414</span><span class="n">_create_webhook_requests</span><span class="p">.</span><span class="nf">rb</span>
      <span class="n">create</span>    <span class="n">app</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">webhook_request</span><span class="p">.</span><span class="nf">rb</span>
      <span class="n">invoke</span>    <span class="n">test_unit</span>
      <span class="n">create</span>      <span class="nb">test</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">webhook_request_test</span><span class="p">.</span><span class="nf">rb</span>
      <span class="n">create</span>      <span class="nb">test</span><span class="o">/</span><span class="n">fixtures</span><span class="o">/</span><span class="n">webhook_requests</span><span class="p">.</span><span class="nf">yml</span>
</code></pre></div></div> <p>Then, I ranÂ <code class="language-plaintext highlighter-rouge">rails db:setup</code>Â andÂ <code class="language-plaintext highlighter-rouge">rails db:migrate</code>Â to set up and create the new tables in the SQLite database.</p> <p><img src="/assets/images/posts/0727ad00-9163-49d3-a153-8c2609631255-Untitled.png" alt="" /></p> <p>To validate that the model works as expected, I logged into the Rails console and tried to create a new webhook record.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails console
Loading development environment <span class="o">(</span>Rails 7.1.3.2<span class="o">)</span>
irb<span class="o">(</span>main<span class="o">)</span>:001&gt; Webhook.create<span class="o">(</span>slug: SecureRandom.uuid, expired_at: Time.now + 7.days<span class="o">)</span>
  TRANSACTION <span class="o">(</span>0.0ms<span class="o">)</span>  begin transaction
  Webhook Create <span class="o">(</span>0.4ms<span class="o">)</span>  INSERT INTO <span class="s2">"webhooks"</span> <span class="o">(</span><span class="s2">"slug"</span>, <span class="s2">"expired_at"</span>, <span class="s2">"created_at"</span>, <span class="s2">"updated_at"</span><span class="o">)</span> VALUES <span class="o">(</span>?, ?, ?, ?<span class="o">)</span> RETURNING <span class="s2">"id"</span>  <span class="o">[[</span><span class="s2">"slug"</span>, <span class="s2">"5b0d4da5-09f7-4549-a275-57cc950dd211"</span><span class="o">]</span>, <span class="o">[</span><span class="s2">"expired_at"</span>, <span class="s2">"2024-03-31"</span><span class="o">]</span>, <span class="o">[</span><span class="s2">"created_at"</span>, <span class="s2">"2024-03-24 01:12:05.816648"</span><span class="o">]</span>, <span class="o">[</span><span class="s2">"updated_at"</span>, <span class="s2">"2024-03-24 01:12:05.816648"</span><span class="o">]]</span>
  TRANSACTION <span class="o">(</span>0.1ms<span class="o">)</span>  commit transaction
<span class="o">=&gt;</span>
<span class="c">#&lt;Webhook:0x0000000127176b00</span>
 <span class="nb">id</span>: 1,
 slug: <span class="s2">"5b0d4da5-09f7-4549-a275-57cc950dd211"</span>,
 expired_at: Sun, 31 Mar 2024,
 created_at: Sun, 24 Mar 2024 01:12:05.816648000 UTC +00:00,
 updated_at: Sun, 24 Mar 2024 01:12:05.816648000 UTC +00:00&gt;
irb<span class="o">(</span>main<span class="o">)</span>:002&gt;
</code></pre></div></div> <p>And there it was - a new webhook record successfully created. This marked another milestone in my journey of building the Webhookdump application. Stay tuned for the next chapter where Iâ€™ll continue to enhance its functionality!</p> </div> <div class="grid grid-cols-2 text-sm"> <a class="prev" href="https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/">&laquo; Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation</a> <a class="next" href="https://rslhdyt.dev/rails-disable-route-format/">Rails Disable Route Format &raquo;</a> </div> <div class="related"> <h4 class="text-xl my-5">Related Posts</h4> <ul class="list-disc list-inside"> <li class="pl-8"> <a href="https://rslhdyt.dev/til-handling-changes-to-sidekiq-worker-class/">TIL: Handling Changes to Sidekiq Worker Class </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/fix-dotenv-not-properly-setup-in-foreman/">Fix dotenv not properly setup in Foreman </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/rails-disable-route-format/">Rails Disable Route Format </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/streamline-your-sidekiq-cron-jobs-with-a-single-worker-class-for-rake-task-invocation/">Streamline Your Sidekiq Cron Jobs with a Single Worker Class for Rake Task Invocation </a> </li> <li class="pl-8"> <a href="https://rslhdyt.dev/setting-up-a-rails-project-for-webhookdump/">Setting Up a Rails Project for Webhookdump </a> </li> </ul> </div> <footer class="flex justify-center items-center border-solid border-0 border-t border-gray-200 p-10 mt-10"> Risal Hidayat Â© 2024 </footer> </div> </body> </html>
